<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/png" href="../download1.png">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IP Info & Map – Raina</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    body {
      background:
        radial-gradient(1200px circle at 20% 10%, rgba(34,197,94,0.10), transparent 45%),
        radial-gradient(1000px circle at 80% 20%, rgba(22,163,74,0.08), transparent 50%),
        linear-gradient(180deg, #020617 0%, #020617 100%);
    }

    #map { height: 520px; }

    @media (max-width: 900px) {
      #map { height: 380px; }
    }
  </style>
</head>

<body class="text-white font-sans min-h-screen overflow-x-hidden">

  <!-- Subtle Green Glow -->
  <div class="pointer-events-none fixed inset-0 flex items-center justify-center">
    <div class="w-[520px] h-[520px] rounded-full 
      bg-gradient-to-r from-emerald-900 via-green-900 to-emerald-800 
      blur-[180px] opacity-20">
    </div>
  </div>

  <main class="relative z-10 px-4 py-10 flex justify-center">
    <div class="grid gap-6 w-full max-w-7xl lg:grid-cols-2">

      <!-- LEFT CARD -->
      <div class="bg-white/5 backdrop-blur-xl border border-white/10 
        rounded-3xl p-6 shadow-2xl">

        <div class="flex items-center gap-4 mb-5">
          <div class="w-11 h-11 rounded-xl 
            bg-emerald-900/40 border border-emerald-400/20
            grid place-items-center font-bold text-emerald-300">
            IP
          </div>
          <div>
            <h1 class="text-xl font-semibold 
              bg-gradient-to-r from-emerald-300 to-green-300 
              bg-clip-text text-transparent">
              IP Lookup
            </h1>
            <p class="text-gray-400 text-sm">
              
            </p>
          </div>
        </div>

        <!-- Pills -->
        <div class="flex flex-wrap gap-2 mb-4">
          <span id="statusPill" class="px-3 py-1 rounded-full text-sm 
            bg-emerald-900/30 border border-emerald-400/30 text-emerald-300">
            Loading…
          </span>
          <span id="ipPill" class="px-3 py-1 rounded-full text-sm 
            bg-white/5 border border-white/10 text-gray-200">
            —
          </span>
          <span id="locPill" class="px-3 py-1 rounded-full text-sm 
            bg-white/5 border border-white/10 text-gray-200">
            —
          </span>
        </div>

        <!-- Fields Grid -->
        <div id="fieldsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"></div>

        <!-- Raw JSON -->
        <div class="bg-white/5 border border-white/10 rounded-2xl p-4 mb-4">
          <label class="text-sm text-gray-400 block mb-2">Full JSON (raw)</label>
          <pre id="rawJson" class="text-sm text-emerald-300 max-h-52 overflow-auto">{ }</pre>
        </div>

        <!-- Buttons -->
        <div class="flex gap-3">
          <button id="refreshBtn" class="px-4 py-2 rounded-xl font-semibold text-emerald-200
            bg-emerald-900/40 border border-emerald-400/30 hover:bg-emerald-900/60 transition">
            ⟳ Refresh
          </button>

          <button id="copyBtn" class="px-4 py-2 rounded-xl font-semibold text-emerald-200
            bg-emerald-900/40 border border-emerald-400/30 hover:bg-emerald-900/60 transition">
            ⧉ Copy JSON
          </button>
        </div>
      </div>

      <!-- RIGHT CARD (MAP) -->
      <div class="bg-white/5 backdrop-blur-xl border border-white/10 
        rounded-3xl p-4 shadow-2xl">

        <div id="map" class="rounded-2xl border border-white/10">
          Loading map…
        </div>
      </div>

    </div>
  </main>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    let map, marker;
    const el = id => document.getElementById(id);

    const setField = (parent, label, val) => {
      const div = document.createElement("div");
      div.className =
        "bg-white/5 border border-white/10 rounded-xl p-3";

      div.innerHTML = `
        <label class="text-xs text-emerald-300 block mb-1">${label}</label>
        <div class="font-semibold text-sm text-white break-words">
          ${val ?? "—"}
        </div>
      `;
      parent.appendChild(div);
    };

    async function fetchIP() {
      const res = await fetch("https://ai-cyber-backend-1.onrender.com/ipinfo");
      if (!res.ok) throw new Error("Failed to fetch from backend");
      return res.json();
    }

    async function load() {
      const status = el("statusPill");
      const ip = el("ipPill");
      const loc = el("locPill");
      const grid = el("fieldsGrid");
      const raw = el("rawJson");

      status.textContent = "Loading…";
      grid.innerHTML = "";
      raw.textContent = "{ loading... }";

      try {
        const data = await fetchIP();
        raw.textContent = JSON.stringify(data, null, 2);

        status.textContent = data.status || "Success";
        ip.textContent = data.query || "—";
        loc.textContent =
          `${data.city || ""}, ${data.regionName || ""}, ${data.country || ""}`;

        const keys = [
          "query","country","countryCode","region","regionName",
          "city","zip","lat","lon","timezone","isp","org","as"
        ];

        keys.forEach(k => setField(grid, k.toUpperCase(), data[k]));

        const lat = Number(data.lat);
        const lon = Number(data.lon);

        if (!map) {
          map = L.map("map").setView([lat, lon], 13);
          L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19,
            attribution: "© OpenStreetMap contributors",
          }).addTo(map);
        } else {
          map.setView([lat, lon], 13);
          if (marker) map.removeLayer(marker);
        }

        marker = L.marker([lat, lon]).addTo(map);
        marker
          .bindPopup(`<b>${data.query}</b><br>${data.city}, ${data.country}`)
          .openPopup();

      } catch (err) {
        console.error(err);
        status.textContent = "Error";
        grid.innerHTML = `
          <div class="bg-white/5 border border-red-500/40 rounded-xl p-3">
            <label class="text-xs text-red-400 block mb-1">Error</label>
            <div class="font-semibold text-sm text-red-300">
              ${err.message}
            </div>
          </div>
        `;
      }
    }

    el("refreshBtn").addEventListener("click", load);

    el("copyBtn").addEventListener("click", () => {
      navigator.clipboard.writeText(el("rawJson").textContent);
      el("copyBtn").textContent = "✓ Copied";
      setTimeout(() => (el("copyBtn").textContent = "⧉ Copy JSON"), 1500);
    });

    load();
  </script>
</body>
</html>