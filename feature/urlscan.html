<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="../download1.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Raina ‚Äì URL Safety Scanner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: url("wallpapers/6.jpg") no-repeat center center fixed;
      background-size: cover;
    }
    body::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: -1;
    }
    .transition-theme {
      transition: background-color 0.4s ease, color 0.4s ease, border-color 0.4s ease;
    }
    .glow {
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.5), 0 0 30px rgba(56, 189, 248, 0.2);
    }
    .glow-red {
      box-shadow: 0 0 12px rgba(239, 68, 68, 0.6), 0 0 30px rgba(239, 68, 68, 0.2);
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.2);
      border-top: 4px solid #38bdf8;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      animation: spin 0.8s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .scan-text {
      display: inline-block;
      animation: flicker 2s infinite;
    }
    @keyframes flicker {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }
      20%, 22%, 24%, 55% { opacity: 0; }
    }
  </style>
</head>

<body id="body" class="text-white flex flex-col items-center min-h-screen p-6 gap-6 font-mono transition-theme">
  <a href="../index.html" class="self-start text-gray-400 hover:text-white">‚Üê Back</a>

  <h1 class="text-4xl font-extrabold text-cyan-400 tracking-wider glow">
    üîó Raina ‚Äì <span class="scan-text">URL Safety Scanner</span>
  </h1>

  <p class="max-w-2xl text-gray-400 text-sm leading-relaxed text-center">
    üõ°Ô∏è Enter a link and our scanner will check it using
    <span class="text-cyan-300">Google Safe Browsing</span>
    for <span class="text-red-400">malware</span>,
    <span class="text-yellow-400">phishing</span>,
    and <span class="text-orange-400">dangerous sites</span>.
  </p>

  <!-- Example Box -->
  <div class="w-full max-w-2xl bg-gray-900/70 border border-gray-700 rounded-xl p-4 shadow-lg text-sm text-gray-300">
    <p class="flex items-center gap-2">
      üîó <span class="text-cyan-300 font-semibold">Example test URL:</span>
      <button onclick="fillExample()" class="text-purple-400 hover:underline break-all">
        https://testsafebrowsing.appspot.com/s/phishing.html
      </button>
    </p>
    <p class="mt-2 text-gray-400">‚ö° Click the example to auto-fill and test a known phishing page.</p>
  </div>

  <div class="w-full max-w-xl flex flex-col gap-4">
    <input id="urlInput" type="url" placeholder="https://example.com"
      class="p-3 rounded-xl text-black glow focus:outline-none" />
    <button onclick="checkUrl()" id="scanBtn"
      class="bg-cyan-600 hover:bg-cyan-700 py-3 rounded-xl shadow-lg font-semibold transition-theme glow">
      üöÄ Scan URL
    </button>
    <div id="result" class="text-lg font-bold min-h-[2rem]"></div>
  </div>

  <div id="detailsBox"
    class="hidden w-full max-w-2xl mt-4 bg-gray-800/80 text-white p-4 rounded-xl shadow-lg border border-gray-700 space-y-2 transition-theme">
  </div>

  <div class="w-full max-w-xl bg-gray-950/80 p-4 rounded-xl border border-gray-700 shadow-lg">
    <h2 class="text-lg font-semibold mb-2 text-cyan-300">üïì Scan History (Last 5)</h2>
    <ul id="historyList" class="font-mono text-sm text-green-400 space-y-1"></ul>
  </div>

  <script>
    const EXAMPLE_URL = "https://testsafebrowsing.appspot.com/s/phishing.html";

    function fillExample() {
      const input = document.getElementById("urlInput");
      input.value = EXAMPLE_URL;
      input.focus();
    }

    function isValidUrl(str) {
      try {
        const url = new URL(str);
        return url.protocol === "http:" || url.protocol === "https:";
      } catch (_) {
        return false;
      }
    }

    function setThemeSafe() {
      document.getElementById("body").className =
        "bg-green-950 text-white flex flex-col items-center min-h-screen p-6 gap-6 font-mono transition-theme";
      document.getElementById("scanBtn").className =
        "bg-green-600 hover:bg-green-700 py-3 rounded-xl font-semibold glow transition-theme";
    }

    function setThemeUnsafe() {
      document.getElementById("body").className =
        "bg-red-950 text-white flex flex-col items-center min-h-screen p-6 gap-6 font-mono transition-theme";
      document.getElementById("scanBtn").className =
        "bg-red-600 hover:bg-red-700 py-3 rounded-xl font-semibold glow-red transition-theme";
    }

    function resetTheme() {
      document.getElementById("body").className =
        "text-white flex flex-col items-center min-h-screen p-6 gap-6 font-mono transition-theme";
      document.getElementById("scanBtn").className =
        "bg-cyan-600 hover:bg-cyan-700 py-3 rounded-xl font-semibold glow transition-theme";
    }

    async function checkUrl() {
      const url = document.getElementById("urlInput").value.trim();
      const resultEl = document.getElementById("result");
      const detailsEl = document.getElementById("detailsBox");

      detailsEl.classList.add("hidden");
      detailsEl.innerHTML = "";
      resultEl.textContent = "";
      resetTheme();

      if (!url) {
        resultEl.textContent = "‚ö†Ô∏è Please enter a URL";
        resultEl.className = "text-yellow-400 font-bold";
        return;
      }

      if (!isValidUrl(url)) {
        resultEl.textContent = "‚ùå Invalid URL format";
        resultEl.className = "text-red-400 font-bold";
        return;
      }

      resultEl.innerHTML = '<span class="spinner"></span> Scanning...';
      resultEl.className = "text-white font-bold";

      try {
        const res = await fetch("https://ai-cyber-backend-1.onrender.com/api/check-url", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url })
        });

        const data = await res.json();
        let detections = 0;

        if (data && data.matches && data.matches.length > 0) {
          detections = data.matches.length;
          const match = data.matches[0];

          resultEl.textContent = "‚ùó UNSAFE URL detected!";
          resultEl.className = "text-red-400 font-bold glow-red";
          setThemeUnsafe();

          detailsEl.innerHTML = `
            <p><strong>üõë Threat:</strong> ${match.threatType}</p>
            <p><strong>üß± Platform:</strong> ${match.platformType}</p>
            <p><strong>üîç Type:</strong> ${match.threatEntryType}</p>
            <p><strong>üîó URL:</strong> ${match.threat.url}</p>
          `;
        } else {
          resultEl.textContent = "‚úÖ This URL is clean";
          resultEl.className = "text-green-400 font-bold glow";
          setThemeSafe();

          detailsEl.innerHTML = `
            <p><strong>‚úÖ No issues found for:</strong> ${url}</p>
            <p>This link is not flagged for malware, phishing, or harmful content.</p>
          `;
        }

        saveHistory(url, detections);
        detailsEl.classList.remove("hidden");
      } catch (err) {
        resultEl.textContent = "‚ùå Backend error";
        resultEl.className = "text-red-400 font-bold";
        console.error(err);
      }
    }

    function saveHistory(url, detections) {
      let history = JSON.parse(localStorage.getItem("scanHistory")) || [];
      history.unshift({ url, detections, time: new Date().toLocaleTimeString() });
      if (history.length > 5) history = history.slice(0, 5);
      localStorage.setItem("scanHistory", JSON.stringify(history));
      loadHistory();
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem("scanHistory")) || [];
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      history.forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `[${item.time}] <span class="text-cyan-300">${item.url}</span> ‚Äî 
          <span class="${item.detections > 0 ? "text-red-400" : "text-green-400"}">
            ${item.detections > 0 ? item.detections + " threats" : "Clean"}
          </span>`;
        list.appendChild(li);
      });
    }

    loadHistory();

    function getUrlParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  window.addEventListener("DOMContentLoaded", () => {
    const paramUrl = getUrlParam("url");
    if (paramUrl && isValidUrl(paramUrl)) {
      const input = document.getElementById("urlInput");
      input.value = paramUrl;
      checkUrl(); // auto-run scan
    }
  });
  </script>
</body>
</html>