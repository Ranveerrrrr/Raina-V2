<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Code Decoder ‚Äì Raina</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background:
        radial-gradient(1200px circle at 20% 10%, rgba(102,252,241,0.18), transparent 40%),
        radial-gradient(1000px circle at 80% 20%, rgba(69,162,158,0.14), transparent 45%),
        linear-gradient(180deg, #05070f 0%, #070a16 100%);
    }
  </style>
</head>

<body class="text-white font-sans min-h-screen overflow-x-hidden flex flex-col items-center px-4 py-10">

  <!-- Glow Ring -->
  <div class="pointer-events-none fixed inset-0 flex items-center justify-center">
    <div class="w-[520px] h-[520px] rounded-full 
      bg-gradient-to-r from-cyan-400 via-teal-400 to-cyan-300 
      blur-[170px] opacity-25">
    </div>
  </div>

  <!-- Header -->
  <header class="relative z-10 w-full max-w-xl mb-6 flex items-center justify-between">
    <a href="../index.html"
      class="inline-flex items-center gap-2 text-gray-400 hover:text-white transition">
      ‚Üê Back to Raina
    </a>

    <h1 class="text-xl font-semibold 
      bg-gradient-to-r from-cyan-400 to-teal-400 
      bg-clip-text text-transparent">
      QR Code Decoder
    </h1>
  </header>

  <!-- Main Card -->
  <main class="relative z-10 w-full max-w-md">
    <div class="bg-white/5 backdrop-blur-xl border border-white/10 
      rounded-3xl p-8 shadow-2xl text-center">


      <!-- Example Image Preview -->
      <img id="qrPreview"
        src=""
        alt="QR Preview"
        class="hidden mx-auto mb-4 w-40 h-40 rounded-xl border border-cyan-400/30 bg-black/40" />

      <h2 class="text-lg font-bold 
        bg-gradient-to-r from-cyan-400 to-teal-400 
        bg-clip-text text-transparent mb-2">
        Decode Any QR Code
      </h2>

      <p class="text-gray-400 text-sm mb-6">
        Upload a QR image or try the example to decode instantly.
      </p>

      <button id="exampleBtn"
      class="mb-4 px-4 py-2 rounded-xl text-sm font-semibold text-black
      bg-gradient-to-r from-cyan-400 to-teal-400 
      hover:brightness-110 hover:shadow-lg hover:shadow-cyan-400/20 transition">
      Example QR
    </button>

      <!-- File Input -->
      <input type="file" id="qr-input" accept="image/*"
        class="w-full rounded-2xl border border-cyan-400/30 
        bg-black/40 text-gray-200 p-3 text-sm cursor-pointer
        hover:border-cyan-400 transition" />

      <!-- Loading -->
      <div id="loading"
        class="mt-4 text-sm font-semibold text-cyan-300">
      </div>

      <!-- Result -->
      <div id="result"
        class="mt-5 bg-black/50 border border-cyan-400/20 
        rounded-xl p-4 text-sm text-cyan-300 break-words hidden">
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="relative z-10 mt-10 text-sm text-gray-500 text-center">
    Built by <span class="text-cyan-400 font-semibold">Ranveer</span> ‚Ä¢ Raina Project
  </footer>

  <script>
    const input = document.getElementById("qr-input");
    const loading = document.getElementById("loading");
    const resultDiv = document.getElementById("result");
    const exampleBtn = document.getElementById("exampleBtn");
    const qrPreview = document.getElementById("qrPreview");

    function isValidUrl(str) {
      try {
        new URL(str);
        return true;
      } catch {
        return false;
      }
    }

    function renderResult(text) {
      if (isValidUrl(text)) {
        const encoded = encodeURIComponent(text);
        const target =
          `/feature/urlscan.html?url=${encoded}`;

        resultDiv.innerHTML = `
          <strong class="text-cyan-400">Decoded URL:</strong><br>
          <a href="${target}" 
             class="underline text-cyan-300 hover:text-white transition">
            ${text}
          </a>
          <div class="mt-2 text-xs text-gray-400">
            Click to scan this URL in Raina
          </div>
        `;
      } else {
        resultDiv.innerHTML = `
          <strong class="text-cyan-400">Decoded Text:</strong><br>${text}
        `;
      }

      resultDiv.classList.remove("hidden");
    }

    async function decodeFile(file) {
      resultDiv.classList.add("hidden");
      resultDiv.textContent = "";
      loading.textContent = "üîç Decoding... Please wait.";

      const formData = new FormData();
      formData.append("file", file);

      try {
        const response = await fetch("https://api.qrserver.com/v1/read-qr-code/", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();
        const result = data[0]?.symbol[0]?.data;

        if (result) {
          renderResult(result);
        } else {
          resultDiv.textContent = "‚ùå No QR code detected in the image.";
          resultDiv.classList.remove("hidden");
        }
      } catch (err) {
        console.error(err);
        resultDiv.textContent = "‚ö†Ô∏è Error decoding QR code. Please try again.";
        resultDiv.classList.remove("hidden");
      } finally {
        loading.textContent = "";
      }
    }

    // File upload handler
    input.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      qrPreview.src = URL.createObjectURL(file);
      qrPreview.classList.remove("hidden");

      decodeFile(file);
    });

    // üî• Example QR logic (local qr.png)
    exampleBtn.addEventListener("click", async () => {
      loading.textContent = "üì• Loading example QR...";
      resultDiv.classList.add("hidden");

      try {
        const res = await fetch("qr.png");
        const blob = await res.blob();
        const file = new File([blob], "qr.png", { type: blob.type });

        qrPreview.src = "qr.png";
        qrPreview.classList.remove("hidden");

        decodeFile(file);
      } catch (err) {
        console.error(err);
        loading.textContent = "";
        resultDiv.textContent = "‚ö†Ô∏è Failed to load example QR.";
        resultDiv.classList.remove("hidden");
      }
    });
  </script>
</body>
</html>
