<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="../download1.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Redirect Analyzer â€“ Raina</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background:
        radial-gradient(1200px circle at 20% 10%, rgba(251,146,60,0.18), transparent 40%),
        radial-gradient(1000px circle at 80% 20%, rgba(245,158,11,0.14), transparent 45%),
        linear-gradient(180deg, #05070f 0%, #070a16 100%);
    }
  </style>
</head>

<body class="text-white font-sans min-h-screen overflow-x-hidden flex flex-col items-center px-4 py-10">

  <!-- Glow Ring -->
  <div class="pointer-events-none fixed inset-0 flex items-center justify-center">
    <div class="w-[520px] h-[520px] rounded-full 
      bg-gradient-to-r from-orange-500 via-amber-400 to-orange-400 
      blur-[170px] opacity-25">
    </div>
  </div>

  <!-- Header -->
  <header class="relative z-10 w-full max-w-5xl mb-8 flex items-center justify-between">
    <a href="../index.html"
      class="inline-flex items-center gap-2 text-gray-400 hover:text-white transition">
      â† Back to Raina
    </a>

    <h1 class="text-xl font-semibold 
      bg-gradient-to-r from-orange-400 to-amber-400 
      bg-clip-text text-transparent">
      ğŸ” Redirect Analyzer
    </h1>
  </header>

  <!-- Main Card -->
  <main class="relative z-10 w-full max-w-5xl">
    <div class="bg-white/5 backdrop-blur-xl border border-white/10 
      rounded-3xl p-8 shadow-2xl space-y-6">

      <!-- Example Box (Top, Inline Style) -->
      <div class="bg-black/40 border border-orange-400/30 rounded-2xl px-5 py-4">
        <p class="flex flex-wrap items-center gap-2 text-sm text-orange-200">
          ğŸ”— <span class="font-semibold text-orange-300">Example test URL:</span>
          <button onclick="useExample()" class="text-amber-300 hover:underline break-all">
            https://blog.ahrefs.com
          </button>
        </p>
        <p class="mt-2 text-xs text-orange-300/70">
          âš¡ Click the example to auto-fill and analyze a real redirect chain.
        </p>
      </div>

      <!-- Query Box (Below) -->
      <div class="bg-black/40 border border-orange-400/30 rounded-2xl px-6 py-6">
        <label class="block text-gray-300 font-semibold mb-2">
          Enter URL to analyze
        </label>

        <input id="url" type="text"
          class="w-full rounded-2xl border border-orange-400/30 
          bg-black/60 text-white p-4 text-base
          focus:outline-none focus:border-orange-400 
          focus:ring-2 focus:ring-orange-400/30 transition"
          placeholder="https://example.com" />

        <div class="mt-5 flex justify-center">
          <button id="analyze"
            class="px-8 py-3 rounded-2xl font-semibold text-black
            bg-gradient-to-r from-orange-400 to-amber-400 
            hover:brightness-110 hover:shadow-lg hover:shadow-orange-400/20 transition">
            ğŸš€ Analyze
          </button>
        </div>
      </div>

      <div id="message"
        class="rounded-xl px-4 py-3 text-center font-semibold text-sm hidden">
      </div>

      <!-- Result -->
      <div id="result"
        class="hidden bg-black/40 border border-white/10 
        rounded-2xl p-6 overflow-x-auto">

        <table class="w-full border-collapse text-sm">
          <thead>
            <tr class="text-orange-400 uppercase text-xs tracking-wider">
              <th class="p-3 text-left">#</th>
              <th class="p-3 text-left">Status</th>
              <th class="p-3 text-left">URL</th>
              <th class="p-3 text-left">Redirect â†’</th>
              <th class="p-3 text-left">Time (s)</th>
              <th class="p-3 text-left">IP</th>
            </tr>
          </thead>
          <tbody id="chain"></tbody>
        </table>

        <h3 class="mt-8 mb-2 text-orange-400 font-semibold">
          Final Headers
        </h3>
        <pre id="headers"
          class="bg-black/50 border border-orange-400/20 
          rounded-xl p-4 text-orange-300 text-sm overflow-x-auto"></pre>

        <h3 class="mt-8 mb-2 text-orange-400 font-semibold">
          Raw JSON
        </h3>
        <pre id="raw"
          class="bg-black/50 border border-orange-400/20 
          rounded-xl p-4 text-orange-300 text-sm overflow-x-auto"></pre>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="relative z-10 mt-12 text-sm text-gray-500 text-center">
    Built by <span class="text-orange-400 font-semibold">Ranveer</span> â€¢ Raina Project
  </footer>

  <script>
    const apiBase = 'https://ai-cyber-backend-1.onrender.com/redirect-check';
    const EXAMPLE_URL = 'https://blog.ahrefs.com';

    const urlInput = document.getElementById('url');
    const analyzeBtn = document.getElementById('analyze');

    const msgBox = document.getElementById('message');
    const resultBox = document.getElementById('result');
    const chainTable = document.getElementById('chain');
    const headersBox = document.getElementById('headers');
    const rawBox = document.getElementById('raw');

    function useExample() {
      urlInput.value = EXAMPLE_URL;
      urlInput.focus();
      showMessage('Example URL loaded. Click Analyze.', 'info');
    }

    function showMessage(msg, type='info') {
      msgBox.textContent = msg;
      msgBox.className =
        'rounded-xl px-4 py-3 text-center font-semibold text-sm ' +
        (type === 'error'
          ? 'bg-red-500/10 text-red-400 border border-red-500/30'
          : 'bg-orange-400/10 text-orange-300 border border-orange-400/30');
      msgBox.classList.remove('hidden');
    }

    function badge(code) {
      const n = Number(code);
      if (n >= 200 && n < 300)
        return `<span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-500/15 text-green-400">${n}</span>`;
      if (n >= 300 && n < 400)
        return `<span class="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-500/15 text-yellow-400">${n}</span>`;
      return `<span class="px-3 py-1 rounded-full text-xs font-semibold bg-red-500/15 text-red-400">${n}</span>`;
    }

    async function fetchRedirectChain(url) {
      if (!url) return showMessage('Please enter a URL', 'error');

      showMessage('Analyzing redirects...');

      try {
        const fullUrl = `${apiBase}?url=${encodeURIComponent(url)}&timeout=5&maxhops=10&meta=1`;
        const res = await fetch(fullUrl);
        if (!res.ok) throw new Error('API error');
        const data = await res.json();
        renderResult(data);
        showMessage('Analysis complete!', 'info');
      } catch (err) {
        showMessage('Failed to fetch. Backend offline or invalid URL.', 'error');
        console.error(err);
      }
    }

    function renderResult(data) {
      resultBox.classList.remove('hidden');
      chainTable.innerHTML = '';
      const hops = data.data || [];

      hops.forEach((hop, i) => {
        const info = hop.response?.info || {};
        const tr = document.createElement('tr');
        tr.className = 'border-b border-white/5';
        tr.innerHTML = `
          <td class="p-3">${i + 1}</td>
          <td class="p-3">${badge(info.http_code)}</td>
          <td class="p-3 break-all">${info.url || '-'}</td>
          <td class="p-3 break-all">${info.redirect_url || ''}</td>
          <td class="p-3">${info.total_time?.toFixed(3) || '-'}</td>
          <td class="p-3">${info.primary_ip || '-'}</td>
        `;
        chainTable.appendChild(tr);
      });

      const last = hops[hops.length - 1];
      headersBox.textContent =
        JSON.stringify(last.response?.headers?.parsed || {}, null, 2);
      rawBox.textContent = JSON.stringify(data, null, 2);
    }

    analyzeBtn.onclick = () => fetchRedirectChain(urlInput.value.trim());
  </script>
</body>
</html>