<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Redirect Analyzer</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  
    * {
      box-sizing: border-box;
    }
  
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top left, #0b0c10, #060708 80%);
      font-family: 'Poppins', sans-serif;
      color: #f1f1f1;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
    }
  
    header {
      background: rgba(31, 40, 51, 0.9);
      backdrop-filter: blur(12px);
      width: 100%;
      padding: 20px 0;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      position: sticky;
      top: 0;
      z-index: 10;
    }
  
    header h1 {
      margin: 0;
      font-size: 1.9rem;
      color: #66fcf1;
      letter-spacing: 1px;
    }
  
    .back-btn {
      position: absolute;
      left: 25px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(102, 252, 241, 0.1);
      border: 1px solid rgba(102, 252, 241, 0.2);
      color: #66fcf1;
      font-size: 0.95rem;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: 0.3s;
    }
  
    .back-btn:hover {
      background: rgba(102, 252, 241, 0.2);
      transform: translateY(-50%) scale(1.05);
    }
  
    .container {
      background: rgba(31, 40, 51, 0.8);
      backdrop-filter: blur(20px);
      margin-top: 50px;
      padding: 35px;
      border-radius: 20px;
      box-shadow: 0 8px 35px rgba(102, 252, 241, 0.1);
      max-width: 850px;
      width: 92%;
      animation: fadeIn 0.6s ease;
      transition: all 0.3s ease;
    }
  
    .container:hover {
      box-shadow: 0 10px 40px rgba(102, 252, 241, 0.25);
      transform: translateY(-2px);
    }
  
    label {
      font-weight: 600;
      color: #c5c6c7;
      font-size: 1rem;
    }
  
    input[type="text"] {
      width: 100%;
      padding: 14px 18px;
      margin-top: 10px;
      border-radius: 12px;
      border: none;
      outline: none;
      background-color: rgba(11, 12, 16, 0.9);
      color: #66fcf1;
      font-size: 1rem;
      transition: 0.3s;
    }
  
    input[type="text"]:focus {
      background-color: rgba(18, 21, 26, 1);
      box-shadow: 0 0 12px rgba(102, 252, 241, 0.3);
      transform: scale(1.01);
    }
  
    button {
      background: linear-gradient(135deg, #45a29e, #66fcf1);
      border: none;
      color: #0b0c10;
      font-weight: 700;
      padding: 12px 25px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.25s ease;
      margin-top: 25px;
      letter-spacing: 0.5px;
    }
  
    button:hover {
      background: linear-gradient(135deg, #66fcf1, #45a29e);
      box-shadow: 0 0 12px rgba(102, 252, 241, 0.3);
      transform: translateY(-2px);
    }
  
    .result {
      margin-top: 35px;
      background-color: rgba(11, 12, 16, 0.9);
      border-radius: 15px;
      padding: 25px;
      overflow-x: auto;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeUp 0.6s ease forwards;
    }
  
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
  
    th, td {
      padding: 13px;
      text-align: left;
      border-bottom: 1px solid rgba(102, 252, 241, 0.1);
      color: #d1d1d1;
    }
  
    th {
      color: #66fcf1;
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 1px;
    }
  
    .pill {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.3px;
    }
  
    .ok { background-color: rgba(34,197,94,0.15); color: #22c55e; }
    .warn { background-color: rgba(245,158,11,0.15); color: #f59e0b; }
    .bad { background-color: rgba(239,68,68,0.15); color: #ef4444; }
  
    pre {
      background-color: rgba(18, 21, 26, 0.9);
      color: #9fdfd5;
      padding: 18px;
      border-radius: 12px;
      overflow-x: auto;
      font-size: 0.9rem;
      border: 1px solid rgba(102, 252, 241, 0.1);
    }
  
    footer {
      margin-top: 60px;
      font-size: 0.9rem;
      color: #777;
      text-align: center;
      padding-bottom: 25px;
    }
  
    .message {
      margin-top: 18px;
      padding: 12px 18px;
      border-radius: 10px;
      font-weight: 600;
      text-align: center;
      letter-spacing: 0.3px;
    }
  
    .error { background-color: rgba(239,68,68,0.1); color: #ef4444; }
    .info { background-color: rgba(102,252,241,0.1); color: #66fcf1; }
  
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  
    @keyframes fadeUp {
      to { opacity: 1; transform: translateY(0); }
    }
  </style>  
</head>
<body>
  <header>
    <button class="back-btn" onclick="goBack()">← Back</button>
    <h1>Redirect Analyzer</h1>
  </header>

  <div class="container">
    <label>Enter URL to analyze</label>
    <input type="text" id="url" placeholder="https://example.com" />

    <div style="margin-top:25px;text-align:center;">
      <button id="analyze">Analyze</button>
      <button id="sample">Try Sample</button>
    </div>

    <div id="message" class="message"></div>

    <div class="result" id="result" style="display:none">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Status</th>
            <th>URL</th>
            <th>Redirect →</th>
            <th>Time (s)</th>
            <th>IP</th>
          </tr>
        </thead>
        <tbody id="chain"></tbody>
      </table>

      <h3 style="margin-top:20px;color:#66fcf1;">Final Headers</h3>
      <pre id="headers"></pre>

      <h3 style="margin-top:20px;color:#66fcf1;">Raw JSON</h3>
      <pre id="raw"></pre>
    </div>
  </div>

  <footer>Built by Ranveer | Redirect Checker Tool</footer>

  <script>
    const apiBase = 'https://ai-cyber-backend-1.onrender.com/redirect-check';

    function goBack() {
      window.location.href = '../index.html';
    }

    const urlInput = document.getElementById('url');
    const analyzeBtn = document.getElementById('analyze');
    const sampleBtn = document.getElementById('sample');
    const msgBox = document.getElementById('message');
    const resultBox = document.getElementById('result');
    const chainTable = document.getElementById('chain');
    const headersBox = document.getElementById('headers');
    const rawBox = document.getElementById('raw');

    function showMessage(msg, type='info') {
      msgBox.textContent = msg;
      msgBox.className = `message ${type}`;
    }

    function badge(code) {
      const n = Number(code);
      if (n >= 200 && n < 300) return `<span class='pill ok'>${n}</span>`;
      if (n >= 300 && n < 400) return `<span class='pill warn'>${n}</span>`;
      return `<span class='pill bad'>${n}</span>`;
    }

    async function fetchRedirectChain(url) {
      if (!url) return showMessage('Please enter a URL', 'error');

      showMessage('Analyzing redirects...');

      try {
        const fullUrl = `${apiBase}?url=${encodeURIComponent(url)}&timeout=5&maxhops=10&meta=1`;
        const res = await fetch(fullUrl);
        if (!res.ok) throw new Error('API error');
        const data = await res.json();
        renderResult(data);
        showMessage('Analysis complete!', 'info');
      } catch (err) {
        showMessage('Failed to fetch. Backend offline or invalid URL.', 'error');
        console.error(err);
      }
    }

    function renderResult(data) {
      resultBox.style.display = 'block';
      chainTable.innerHTML = '';
      const hops = data.data || [];

      hops.forEach((hop, i) => {
        const info = hop.response?.info || {};
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${badge(info.http_code)}</td>
          <td>${info.url || '-'}</td>
          <td>${info.redirect_url || ''}</td>
          <td>${info.total_time?.toFixed(3) || '-'}</td>
          <td>${info.primary_ip || '-'}</td>
        `;
        chainTable.appendChild(tr);
      });

      const last = hops[hops.length - 1];
      headersBox.textContent = JSON.stringify(last.response?.headers?.parsed || {}, null, 2);
      rawBox.textContent = JSON.stringify(data, null, 2);
    }

    analyzeBtn.onclick = () => fetchRedirectChain(urlInput.value.trim());
    sampleBtn.onclick = () => {
      urlInput.value = 'https://blog.ahrefs.com';
      fetchRedirectChain(urlInput.value);
    };
  </script>
</body>
</html>